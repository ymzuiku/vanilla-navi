!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("querystring-number")):"function"==typeof define&&define.amd?define(["querystring-number"],n):(t=t||self).vanillaNavi=n(t.queryString)}(this,function(e){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var i=/MicroMessenger/.test(navigator.userAgent);return function(){var a={isPopBlock:!1,initData:null,routers:{},division:"#",paths:[],rootElement:document.createElement("div"),navis:{},listenFunctions:{},listenFunctionKey:0};function r(t,n,e){i?window.history.replaceState("wechat","",p(a.initData.path,a.initData.params)):window.history.pushState(t,n,e)}function s(n,e){if(void 0!==a.routers[n]){var i=p(n,e),t=a.routers[n](e);t.then?t.then(function(t){return o(t.default)}):o(t)}else s(a.initData.path,a.initData.params);function o(t){r(e,i,i),u(),a.paths.push({path:n,params:e,hash:p(n,e)}),t.setAttribute("data-navi-path",i),a.rootElement.append(t)}}function n(t){if(a.isPopBlock=!0,a&&a.rootElement&&a.rootElement.lastChild){var n=a.rootElement.lastChild._naviBeforePop;n?(n.event(),setTimeout(function(){e()},n.duration)):e()}function e(){u(),a.paths.pop(),t||window.history.back(),a.rootElement.lastChild&&a.rootElement.removeChild(a.rootElement.lastChild)}}function u(){Object.keys(a.listenFunctions).forEach(function(t){(0,a.listenFunctions[Number(t)])({path:a.paths[a.paths.length-1].path,params:a.paths[a.paths.length-1].params})})}function l(t){if(void 0===t&&(t=window.location.hash),(t=t.replace(a.division,""))&&-1<=t.indexOf("?")){var n=t.split("?");return[n[0],e.parse(n[1])||void 0]}return[t,void 0]}function p(t,n){return n?""+a.division+t+"?"+e.stringify(n):""+a.division+t}a.rootElement.style.width="100%",a.rootElement.style.height="100%",a.rootElement.id="navi-root";var t={root:a.rootElement,canPop:function(){return 1<=a.rootElement.childNodes.length},push:s,pop:n,listen:function(t){var n=a.listenFunctionKey++;return a.listenFunctions[n]=t,function(){delete a.listenFunctions[n]}},detail:a,use:function(t,n){a.routers[t]=n},init:function(t,n){var e,i;if(a.initData||(a.initData={path:t,params:n}),window.location.hash){var o=l();e=o[0],i=o[1]}s(t,n),e&&JSON.stringify({path:t,params:n})!==JSON.stringify({path:e,params:i})&&s(e,i)},hashParse:l,hashStringify:p};return"undefined"!=typeof window&&window.addEventListener("popstate",function(t){a.isPopBlock?a.isPopBlock=!1:(r({temp:"1"},"",""),n())}),t}});
//# sourceMappingURL=index.js.map
